<!-- AJAX - Asynchronous Javascript AND XML - allow us to communicate with remote web
servers in an Asynchronous way, with ajax call we can request server for data,
behind the page. -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ajax</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <style type="text/css">
      .card {
        /* opacity: 0; */
        transition: opacity 4s;
      }
    </style>
  </head>
  <body>
    <div class="row">
      <div id="loader"></div>
    </div>

    country: <input type="text" id="cn" value="bangladesh" />
    <button id="btn">Load</button>

    <script lang="Javascript">
        const btn = document.querySelector("#btn");
        const box = document.querySelector(".row");
        const loader = document.querySelector("#loader");
        const cn = document.querySelector("#cn");

        btn.addEventListener("click",()=>{
          box.innerHTML = "";
          const country = cn.value;
          loader.innerHTML = "loading...";

          const url = "https://restcountries.com/v3.1/name/"+country;
           fetch(url)
           .then(res=>{

            if(!res.ok){
              throw new Error("Country not found");
            }

            return res.json()
          })
           .then(res=>{
            const data = res[0];
            renderHTML(data);
                if(data.borders){
                  for(let bdr of data.borders){
                      const urlBdr = "https://restcountries.com/v3.1/alpha/"+bdr;
                       fetch(urlBdr)
                       .then(res=>res.json())
                       .then(res=>{
                        renderHTML(res[0], true);
                       });
                  }
                }
                else{
                  throw new Error("no border found");
                }
           })
           .catch(err=>{
            // alert(err);
            console.log(err);
           })
           .finally(()=>{
            // alert("loaded")
              loader.innerHTML = "";
           });

          });



        // functions
      function renderHTML(data, border=false){
             const html = `
             <div class='col'>
            <div class='card ${border ? 'w-50 border border-primary':''}  '>
             <img src=${data.flags.png} >
              <div class='card-body'>
              <div class='card-title'><b>${data.name.common}</b></div>
                  <ul>
                      <li>Population: ${data.population}</li>
                      <li>Capital: ${data.capital[0]}</li>
                      <li>Currency: ${Object.keys(data.currencies)[0]}</li>
                  </ul>

              </div>
               </div>
           </div>
              `;
              box.insertAdjacentHTML('beforeend', html);
              // box.style.opacity = 1;
        }

      // function fetchData(url){

      // }
    </script>
  </body>
</html>
